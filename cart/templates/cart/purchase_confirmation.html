{% extends 'base.html' %}
{% block content %}
<div class="p-3">
  <div class="container">
    <div class="row mt-3">
      <div class="col mx-auto mb-3">
        <h2>Purchase Completed</h2>
        <hr />
        <div class="alert alert-success">
          <p>Congratulations, purchase completed. Order number is: <b>#{{ template_data.order_id }}</b></p>
        </div>

        <!-- ADD THIS FEEDBACK SECTION -->
        {% if not template_data.feedback_exists %}
        <div class="card mt-4">
          <div class="card-header bg-light">
            <h5 class="mb-0">Share Your Checkout Experience</h5>
          </div>
          <div class="card-body">
            <form method="POST">
              {% csrf_token %}
              
              <div class="mb-3 form-check">
                {{ template_data.form.anonymous }}
                <label class="form-check-label" for="{{ template_data.form.anonymous.id_for_label }}">
                  {{ template_data.form.anonymous.label }}
                </label>
              </div>
              
              <div class="mb-3" id="username-field">
                <label for="{{ template_data.form.username.id_for_label }}" class="form-label">
                  {{ template_data.form.username.label }}
                </label>
                {{ template_data.form.username }}
                <div class="form-text">Leave blank if you want to remain anonymous</div>
              </div>
              
              <div class="mb-3">
                <label for="{{ template_data.form.feedback.id_for_label }}" class="form-label">
                  {{ template_data.form.feedback.label }}
                </label>
                {{ template_data.form.feedback }}
              </div>
              
              <button type="submit" class="btn btn-primary">Submit Feedback</button>
              <a href="{% url 'movies.index' %}" class="btn btn-outline-secondary">Skip</a>
            </form>
            
            <!-- ADD FEEDBACK HISTORY LINK -->
            <div class="mt-3 pt-3 border-top">
              <p class="text-muted mb-0">
                <small>
                  <i class="fas fa-info-circle me-1"></i>
                  You can view all your feedback submissions on your 
                  <a href="{% url 'cart.feedback_list' %}">Feedback History</a> page.
                </small>
              </p>
            </div>
          </div>
        </div>
        {% else %}
        <div class="alert alert-info mt-4">
          <h5 class="alert-heading">Thank you for your feedback!</h5>
          <p>Your feedback has been recorded successfully.</p>
          <div class="mt-3">
            <a href="{% url 'movies.index' %}" class="btn btn-primary me-2">Continue Shopping</a>
            <a href="{% url 'cart.feedback_list' %}" class="btn btn-outline-primary">
              <i class="fas fa-history me-1"></i>View Feedback History
            </a>
          </div>
        </div>
        {% endif %}
        <!-- END OF FEEDBACK SECTION -->

      </div>
    </div>
  </div>
</div>

<!-- ADD THIS JAVASCRIPT -->
<script>
  // Show/hide username field based on anonymous checkbox
  document.addEventListener('DOMContentLoaded', function() {
    const anonymousCheckbox = document.getElementById('{{ template_data.form.anonymous.id_for_label }}');
    const usernameField = document.getElementById('username-field');
    
    function toggleUsernameField() {
      usernameField.style.display = anonymousCheckbox.checked ? 'none' : 'block';
    }
    
    if (anonymousCheckbox && usernameField) {
      anonymousCheckbox.addEventListener('change', toggleUsernameField);
      toggleUsernameField(); // Initial check
    }
  });
</script>

<!-- ADD THIS STYLING -->
<style>
  .card {
    border: none;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .card-header {
    border-radius: 10px 10px 0 0 !important;
  }

  .btn-primary {
    background-color: #0d6efd;
    border-color: #0d6efd;
  }

  .btn-primary:hover {
    background-color: #0b5ed7;
    border-color: #0a58ca;
  }

  .alert-success {
    border-left: 4px solid #198754;
  }

  .alert-info {
    border-left: 4px solid #0dcaf0;
  }
  
  .border-top {
    border-top: 1px solid #dee2e6 !important;
  }
</style>
{% endblock content %}